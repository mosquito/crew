machine:
  services:
    - rabbitmq-server

dependencies:
  pre:
    - mkdir -p venvs
    - virtualenv -p /usr/bin/python3.4 venvs/py34
    - virtualenv -p /usr/bin/python2.7 venvs/py27
    - venvs/py34/bin/pip install wheel
    - venvs/py27/bin/pip install wheel
    - venvs/py34/bin/pip install tornado nose requests
    - venvs/py27/bin/pip install tornado nose requests

  override:
    - venvs/py34/bin/pip install -e .
    - venvs/py27/bin/pip install -e .

test:
  pre:
    - deactivate && source venvs/py34/bin/activate && deactivate
  override:
    - source venvs/py34/bin/activate
    - sudo rabbitmqctl stop_app
    - sudo rabbitmqctl reset
    - sudo rabbitmqctl start_app
    - venvs/py34/bin/nosetests -vd tests/*
    - deactivate
    - sudo rabbitmqctl stop_app
    - sudo rabbitmqctl reset
    - sudo rabbitmqctl start_app
    - source venvs/py27/bin/activate
    - venvs/py27/bin/nosetests -vd tests/*
    - deactivate